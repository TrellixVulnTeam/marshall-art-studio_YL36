<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="API Guides|Product Definition|Workflow Management">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Workflow Management Database Updates</title>
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/NewStylesheet.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: #f7f7f8 url('file://vmware-host/Shared Folders/Documents/My Projects/AgencyPortal 5.0/Output/Jami_Delia/Online Output/Website Output/Skins/Default/Stylesheets/Images/left-arrow.png') no-repeat center center;
}

.button.current-topic-index-button
{
	-pie-background: linear-gradient(#ffffff, #ffffff);
}

.button.next-topic-button
{
	-pie-background: #f7f7f8 url('file://vmware-host/Shared Folders/Documents/My Projects/AgencyPortal 5.0/Output/Jami_Delia/Online Output/Website Output/Skins/Default/Stylesheets/Images/right-arrow.png') no-repeat center center;
}

.needs-pie
{
	behavior: url('../../../../../Resources/Scripts/PIE.htc');
}

</style>
        <script src="../../../Resources/prettify/run_prettify.js">
        </script>
        <script src="../../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../../../Default.htm#Content/API Guide/Product Definitions/Workflow Management/Workflow Management Database Updates.htm">Open topic with navigation</a>
        </p>
        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="../../API Guide.htm">API Guides</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="../Product Definitions.htm">Product Definition</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="Workflow Management.htm">Workflow Management</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Workflow Management Database Updates</span>
        </div>
        <h1>Workflow Management Database Updates</h1>
        <p>The base workflow manager implementation coordinates database update operations against the work item table(s), the audit trail log and, in the case of updateAPData instruction types, the xmlstore table. In the case of an error situation, or a display side connector scenario, an instruction may be run because of an outcome. If that is the case, the commit to the database is immediate once all of the instructions within a connector set have finished executing.</p>
        <p>If an instruction is fired in a non error situation, the commit to the database is part of the unit of work that controls updates to the xmlstore, workitem and precondition realms controlled by AgencyPortal's data engine.</p>
        <p>For custom persistence, the workflow manager's persist() method must be overrriden. The following is an example:</p><pre class="prettyprint"><p>public class CustomWorkflowManager extends WorkflowManager {
    /* (non-Javadoc)
     * @see com.agencyport.workflow.WorkflowManager#persist()
     */
    @Override
    public void persist() throws WorkflowException {
		// We most certainly want the work item table to be updated
		super.persist();
		try {
			final String updateSQL = "update custom_table set custom_column = ? where work_item_id = ?";
			DatabaseResourceAgent dra = getDatabaseResourceAgent();
			// Get addressability to the same connection the framework is using.
			dra.getConnection(false);
			WorkflowContext context = this.getContext();
			IWorkItem workItem = context.getWorkItem();
			// The database resource agent will track the prepared statement and will be released by
			// the framework. The example here is entirely a fabrication. We are taking a work item property and saving to another table
			PreparedStatement pStmt = dra.getPreparedStatement(updateSQL);
			// Get some custom value set by the custom action that will be written to this special custom table that the carryOutCustom method initialized.
			String customValue = context.getControlData().get(“MY_CUSTOM_VALUE”);
     
			pStmt.setString(1, customValue);
			pStmt.setInt(2, workItem.getWorkItemId().intValue());
			pStmt.executeUpdate();
		}
		catch (Exception exception){
			throw new WorkflowException(exception);
		}
    }
}</p></pre>
        <div class="buttons inline-buttons clearfix topicToolbarProxy" style="mc-topic-toolbar-items: ;">
            <div class="button-group-container-left">
                <button class="button needs-pie previous-topic-button" type="button" title="Navigate previous">
                    <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                </button>
                <div class="button current-topic-index-button disabled"><span class="sequence-index"></span> of <span class="sequence-total"></span></div>
                <button class="button needs-pie next-topic-button" type="button" title="Navigate next">
                    <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                </button>
            </div>
        </div>
    </body>
</html>